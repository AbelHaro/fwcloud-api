<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>models/policy_r__ipobj.js - FWCloud API REST Documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://foswiki.soltecsis.com/codedoc/soltecsis-logo1.png" title="FWCloud API REST Documentation"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ClusterRouter.html">ClusterRouter</a></li>
                                <li><a href="../classes/FirewallModel.html">FirewallModel</a></li>
                                <li><a href="../classes/FirewallRouter.html">FirewallRouter</a></li>
                                <li><a href="../classes/IpobjsRouter.html">IpobjsRouter</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ClusterRouter.html">ClusterRouter</a></li>
                                <li><a href="../modules/FirewallModel.html">FirewallModel</a></li>
                                <li><a href="../modules/FirewallRouter.html">FirewallRouter</a></li>
                                <li><a href="../modules/IpobjsRouter.html">IpobjsRouter</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: models/policy_r__ipobj.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var db = require(&#x27;../db.js&#x27;);
var async = require(&#x27;async&#x27;);

//create object
var policy_r__ipobjModel = {};
var tableModel = &quot;policy_r__ipobj&quot;;

/**
 * Property Logger to manage App logs
 *
 * @property logger
 * @type log4js/app
 * 
 */
var logger = require(&#x27;log4js&#x27;).getLogger(&quot;app&quot;);


//Get All policy_r__ipobj by Policy_r (rule)
policy_r__ipobjModel.getPolicy_r__ipobjs = function (rule, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; WHERE rule=&#x27; + connection.escape(rule) + &#x27; ORDER BY position_order&#x27;;

        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else
                callback(null, rows);
        });
    });

};

//Get All policy_r__ipobj by Policy_r (rule) and position
policy_r__ipobjModel.getPolicy_r__ipobjs_position = function (rule, position, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; WHERE rule=&#x27; + connection.escape(rule) + &#x27; AND position=&#x27; + connection.escape(position) + &#x27; ORDER BY position_order&#x27;;

        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else
                callback(null, rows);
        });
    });

};
//Get All policy_r__ipobj by Policy_r (rule) and position
policy_r__ipobjModel.getPolicy_r__ipobjs_interfaces_position = function (rule, position, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);


        var sql = &#x27;SELECT rule,ipobj, ipobj_g, interface, position, position_order, negate, &quot;O&quot; as type FROM &#x27; + tableModel + &#x27; WHERE rule=&#x27; + connection.escape(rule) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; UNION SELECT rule,interface,0,0,position,position_order, negate, &quot;I&quot; as type  from policy_r__interface &#x27; + &#x27; WHERE rule=&#x27; + connection.escape(rule) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; ORDER BY position_order&#x27;;

        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else
                callback(null, rows);
        });
    });

};

//Get All policy_r__ipobj by Policy_r (rule) and position
policy_r__ipobjModel.getPolicy_r__ipobjs_position_data = function (rule, position, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql_obj = &quot; INNER JOIN ipobj O on O.id=P.ipobj &quot;;
        var sql = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; P &#x27; + sql_obj + &#x27; WHERE P.rule=&#x27; + connection.escape(rule) + &#x27; AND P.position=&#x27; + connection.escape(position) + &#x27; ORDER BY P.position_order&#x27;;
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else
                callback(null, rows);
        });
    });

};

//Get  policy_r__ipobj by primarykey
policy_r__ipobjModel.getPolicy_r__ipobj = function (rule, ipobj, ipobj_g, interface, position, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT * FROM &#x27; + tableModel +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; ORDER BY position_order&#x27;;

        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else
                callback(null, rows);
        });
    });
};


//Add new policy_r__ipobj 
policy_r__ipobjModel.insertPolicy_r__ipobj = function (policy_r__ipobjData, set_negate, callback) {


    //Check if IPOBJ TYPE is ALLOWED in this Position  ONLY &#x27;O&#x27; POSITIONS
    checkIpobjPosition(policy_r__ipobjData.rule, policy_r__ipobjData.ipobj, policy_r__ipobjData.ipobj_g, policy_r__ipobjData.interface, policy_r__ipobjData.position, function (error, data) {
        if (error) {
            callback(error, null);
        } else {
            allowed = data;
            if (allowed) {
                //Check if the IPOBJ in this position are negated
                getNegateRulePosition(policy_r__ipobjData.rule, policy_r__ipobjData.position, function (error, data) {
                    if (error) {
                        callback(error, null);
                    } else {
                        negate = data;
                        if (set_negate)
                            negate = 1;

                        db.get(function (error, connection) {
                            if (error)
                                callback(error, null);
                            
                            connection.query(&#x27;INSERT INTO &#x27; + tableModel + &#x27; SET negate=&#x27; + negate + &#x27;, ?&#x27;, policy_r__ipobjData, function (error, result) {
                                if (error) {
                                    logger.debug(error);
                                    callback(error, {&quot;result&quot;: false, &quot;allowed&quot;: 1});
                                } else {
                                    if (result.affectedRows &gt; 0) {
                                        OrderList(policy_r__ipobjData.position_order, policy_r__ipobjData.rule, policy_r__ipobjData.position, 999999, policy_r__ipobjData.ipobj, policy_r__ipobjData.ipobj_g, policy_r__ipobjData.interface);
                                        callback(null, {&quot;result&quot;: true, &quot;allowed&quot;: 1});
                                    } else {
                                        callback(null, {&quot;result&quot;: false, &quot;allowed&quot;: 1});
                                    }
                                }
                            });
                        });
                    }
                });
            } else {
                callback(null, {&quot;result&quot;: false, &quot;allowed&quot;: 0});
            }
        }
    });

};

//Update policy_r__ipobj
policy_r__ipobjModel.updatePolicy_r__ipobj = function (rule, ipobj, ipobj_g, interface, position, position_order, policy_r__ipobjData, callback) {



    //Check if IPOBJ TYPE is ALLOWED in this Position
    //checkIpobjPosition(rule, ipobj, ipobj_g, interface, position, callback) {
    checkIpobjPosition(policy_r__ipobjData.rule, policy_r__ipobjData.ipobj, policy_r__ipobjData.interface, policy_r__ipobjData.position, function (error, data) {
        if (error) {
            callback(error, null);
        } else {
            allowed = data;
            if (allowed) {
                //Check if the IPOBJ in this position are negated
                getNegateRulePosition(policy_r__ipobjData.rule, policy_r__ipobjData.position, function (error, data) {
                    if (error) {
                        logger.debug(&quot;ERROR : &quot;, error);
                    } else {
                        negate = data;
                        logger.debug(&quot;RULE: &quot; + policy_r__ipobjData.rule, +&quot;  Position: &quot; + policy_r__ipobjData.position + &quot;  NEGATE: &quot; + negate);
                        db.get(function (error, connection) {
                            if (error)
                                callback(error, null);
                            var sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET &#x27; +
                                    &#x27;rule = &#x27; + connection.escape(policy_r__ipobjData.rule) + &#x27;,&#x27; +
                                    &#x27;ipobj = &#x27; + connection.escape(policy_r__ipobjData.ipobj) + &#x27;,&#x27; +
                                    &#x27;ipobj_g = &#x27; + connection.escape(policy_r__ipobjData.ipobj_g) + &#x27;,&#x27; +
                                    &#x27;interface = &#x27; + connection.escape(policy_r__ipobjData.interface) + &#x27;,&#x27; +
                                    &#x27;position = &#x27; + connection.escape(policy_r__ipobjData.position) + &#x27;,&#x27; +
                                    &#x27;position_order = &#x27; + connection.escape(policy_r__ipobjData.position_order) + &#x27;, &#x27; +
                                    &#x27;negate = &#x27; + connection.escape(negate) + &#x27; &#x27; +
                                    &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                                    &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position) +
                                    &#x27; AND interface=&#x27; + connection.escape(interface);

                            connection.query(sql, function (error, result) {
                                if (error) {
                                    callback(error, null);
                                } else {
                                    if (result.affectedRows &gt; 0) {
                                        if (position !== policy_r__ipobjData.position) {
                                            //ordenamos posicion antigua
                                            OrderList(999999, rule, position, position_order, ipobj, ipobj_g, interface);
                                            //ordenamos posicion nueva
                                            OrderList(policy_r__ipobjData.position_order, policy_r__ipobjData.rule, policy_r__ipobjData.position, 999999, ipobj, ipobj_g, interface);
                                        } else
                                            OrderList(policy_r__ipobjData.position_order, rule, position, position_order, ipobj, ipobj_g, interface);
                                        callback(null, {&quot;result&quot;: true, &quot;allowed&quot;: 1});
                                    } else {
                                        callback(null, {&quot;result&quot;: false, &quot;allowed&quot;: 1});
                                    }
                                }
                            });
                        });
                    }
                });
            } else {
                callback(null,{ &quot;result&quot;: false, &quot;allowed&quot;: 0});
            }
        }
    });
};

//Update policy_r__ipobj Position ORDER
policy_r__ipobjModel.updatePolicy_r__ipobj_position_order = function (rule, ipobj, ipobj_g, interface, position, position_order, new_order, callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET &#x27; +
                &#x27;position_order = &#x27; + connection.escape(new_order) + &#x27; &#x27; +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; AND interface=&#x27; + connection.escape(interface);

        connection.query(sql, function (error, result) {
            if (error) {
                callback(error, null);
            } else {
                if (result.affectedRows &gt; 0) {
                    OrderList(new_order, rule, position, position_order, ipobj, ipobj_g, interface);
                    callback(null, {&quot;result&quot;: true});
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            }
        });
    });
};

//Update policy_r__ipobj POSITION
//When Update position we order New and Old POSITION
policy_r__ipobjModel.updatePolicy_r__ipobj_position = function (rule, ipobj, ipobj_g, interface, position, position_order, new_rule, new_position, new_order, callback) {

    //Check if IPOBJ TYPE is ALLOWED in this Position    
    checkIpobjPosition(new_rule, ipobj, ipobj_g, interface, new_position, function (error, data) {
        if (error) {
            callback(error, null);
        } else {
            allowed = data;
            if (allowed) {
                getNegateRulePosition(new_rule, new_position, function (error, data) {
                    if (error) {
                        logger.debug(&quot;ERROR : &quot;, error);
                    } else {
                        negate = data;
                        db.get(function (error, connection) {
                            if (error)
                                callback(error, null);


                            var sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET &#x27; +
                                    &#x27;rule = &#x27; + connection.escape(new_rule) + &#x27;, &#x27; +
                                    &#x27;position = &#x27; + connection.escape(new_position) + &#x27;, &#x27; +
                                    &#x27;position_order = &#x27; + connection.escape(new_order) + &#x27;, &#x27; +
                                    &#x27;negate = &#x27; + connection.escape(negate) + &#x27; &#x27; +
                                    &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                                    &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position) +
                                    &#x27; AND interface=&#x27; + connection.escape(interface);
                            logger.debug(sql);
                            connection.query(sql, function (error, result) {
                                if (error) {
                                    callback(error, null);
                                } else {
                                    if (result.affectedRows &gt; 0) {
                                        //Order New position
                                        OrderList(new_order, new_rule, new_position, 999999, ipobj, ipobj_g, interface);
                                        //Order Old position
                                        OrderList(999999, rule, position, position_order, ipobj, ipobj_g, interface);

                                        callback(null, {&quot;result&quot;: true});
                                    } else {
                                        callback(null, {&quot;result&quot;: false});
                                    }
                                }
                            });
                        });
                    }
                });

            } else {
                callback(null,{ &quot;result&quot;: false, &quot;allowed&quot;: 0});
            }
        }
    });
};
//Update policy_r__ipobj NEGATE
//UPDATE ALL IPOBJ in this Position to new NEGATE status
policy_r__ipobjModel.updatePolicy_r__ipobj_negate = function (rule, position, negate, callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET &#x27; +
                &#x27;negate = &#x27; + connection.escape(negate) + &#x27; &#x27; +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; &#x27; +
                &#x27; AND position=&#x27; + connection.escape(position);
        connection.query(sql, function (error, result) {
            if (error) {
                callback(error, null);
            } else {
                callback(null, {&quot;result&quot;: true});
            }
        });
    });
};
function OrderList(new_order, rule, position, old_order, ipobj, ipobj_g, interface) {
    var increment = &#x27;+1&#x27;;
    var order1 = new_order;
    var order2 = old_order;
    if (new_order &gt; old_order) {
        increment = &#x27;-1&#x27;;
        order1 = old_order;
        order2 = new_order;
    }
    logger.debug(&quot;---&gt; ORDENANDO RULE : &quot; + rule + &quot; IPOBJ:&quot; + ipobj + &quot; Interface:&quot; + interface + &quot; IPOBJ_G:&quot; + ipobj_g + &quot;  POSITION: &quot; + position + &quot;  OLD_ORDER: &quot; + old_order + &quot;  NEW_ORDER: &quot; + new_order);

    sql_obj = &#x27;&#x27;;
    if (ipobj &gt; 0)
        sql_obj = &#x27; AND ipobj&lt;&gt;&#x27; + ipobj;
    else if (interface &gt; 0)
        sql_obj = &#x27; AND interface&lt;&gt;&#x27; + interface;
    else if (ipobj_g &gt; 0)
        sql_obj = &#x27; AND ipobj_g&lt;&gt;&#x27; + ipobj_g;

    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET &#x27; +
                &#x27;position_order = position_order&#x27; + increment +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; AND position_order&gt;=&#x27; + order1 + &#x27; AND position_order&lt;=&#x27; + order2 + sql_obj;
        logger.debug(sql);
        connection.query(sql);
    });
}


function checkIpobjPosition(rule, ipobj, ipobj_g, interface, position,  callback) {

    var allowed = 0;
    db.get(function (error, connection) {
        if (error)
            callback(null, 0);
        var sql = &quot;&quot;;
        if (ipobj &gt; 0) {
            sql = &#x27;select A.allowed from ipobj O &#x27; +
                    &#x27;inner join ipobj_type T on O.type=T.id &#x27; +
                    &#x27;inner join ipobj_type__policy_position A on A.type=O.type &#x27; +
                    &#x27;inner join policy_position P on P.id=A.position &#x27; +
                    &#x27; WHERE O.id = &#x27; + connection.escape(ipobj) + &#x27; AND A.position=&#x27; + connection.escape(position) + &#x27;  AND P.content=&quot;O&quot;&#x27; ;
        } else if (ipobj_g &gt; 0) {
            sql = &#x27;select A.allowed from ipobj_g O &#x27; +
                    &#x27;inner join ipobj_type T on O.type=T.id &#x27; +
                    &#x27;inner join ipobj_type__policy_position A on A.type=O.type &#x27; +
                    &#x27;inner join policy_position P on P.id=A.position &#x27; +
                    &#x27; WHERE O.id = &#x27; + connection.escape(ipobj_g) + &#x27; AND A.position=&#x27; + connection.escape(position) + &#x27;  AND P.content=&quot;O&quot;&#x27; ;
        } else if (interface &gt; 0) {
            sql = &#x27;select A.allowed from interface O &#x27; +
                    &#x27;inner join ipobj_type T on O.interface_type=T.id &#x27; +
                    &#x27;inner join ipobj_type__policy_position A on A.type=O.interface_type &#x27; +
                    &#x27;inner join policy_position P on P.id=A.position &#x27; +
                    &#x27; WHERE O.id = &#x27; + connection.escape(interface) + &#x27; AND A.position=&#x27; + connection.escape(position) + &#x27;  AND P.content=&quot;O&quot;&#x27;;
        }
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else {
                if (rows.length &gt; 0) {
                    allowed = rows[0].allowed;
                    logger.debug(&quot;ALLOWED: &quot; + allowed);
                    if (allowed &gt; 0)
                        callback(null, 1);
                    else
                        callback(null, 0);
                }
                else
                    callback(null, 0);
            }
        });
    });
}

function getNegateRulePosition(rule, position, callback) {

    var Nneg = 0;
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(negate) as neg FROM &#x27; + tableModel +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND position=&#x27; + connection.escape(position) +
                &#x27; AND negate=1&#x27;;
        //logger.debug(&#x27;SQL: &#x27; + sql);
        connection.query(sql, function (error, rows) {
            if (error)
                callback(error, null);
            else {
                Nneg = rows[0].neg;
                //logger.debug(&#x27;Nneg 1: &#x27; + Nneg);
                if (Nneg &gt; 0)
                    callback(null, 1);
                else
                    callback(null, 0);
            }
        });
    });
}
policy_r__ipobjModel.getTypePositions = function (position, new_position, callback) {

    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql1 = &#x27;SELECT id, content FROM policy_position  WHERE id = &#x27; + connection.escape(position);
        var sql2 = &#x27;SELECT id, content FROM policy_position  WHERE id = &#x27; + connection.escape(new_position);
        //logger.debug(&#x27;SQL: &#x27; + sql1);
        connection.query(sql1, function (error, rows) {
            if (error)
                callback(error, null);
            else {
                var content1;
                if (rows.length &gt; 0) {
                    content1 = rows[0].content;
                }

                connection.query(sql2, function (error, rows2) {
                    if (error)
                        callback(error, null);
                    else {
                        var content2;
                        if (rows2.length &gt; 0) {
                            content2 = rows2[0].content;
                        }

                        logger.debug(&#x27;Position: &#x27; + position + &#x27;  Content: &#x27; + content1 + &#x27;  New Position: &#x27; + new_position + &#x27;  Content: &#x27; + content2);
                        callback(null, {&quot;content1&quot;: content1, &quot;content2&quot;: content2});
                    }
                });
            }
        });
    });
};

//Remove policy_r__ipobj 
policy_r__ipobjModel.deletePolicy_r__ipobj = function (rule, ipobj, ipobj_g, interface, position, position_order, callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sqlExists = &#x27;SELECT * FROM &#x27; + tableModel +
                &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position);
        connection.query(sqlExists, function (error, row) {
            //If exists Id from policy_r__ipobj to remove
            if (row) {
                db.get(function (error, connection) {
                    var sql = &#x27;DELETE FROM &#x27; + tableModel +
                            &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND ipobj=&#x27; + connection.escape(ipobj) +
                            &#x27; AND ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND position=&#x27; + connection.escape(position) +
                            &#x27; AND interface=&#x27; + connection.escape(interface);
                    connection.query(sql, function (error, result) {
                        if (error) {
                            callback(error, null);
                        } else {
                            if (result.affectedRows &gt; 0) {
                                OrderList(999999, rule, position, position_order, ipobj, ipobj_g, interface);
                                callback(null, {&quot;result&quot;: true, &quot;msg&quot;: &quot;deleted&quot;});
                            } else {
                                callback(null, {&quot;result&quot;: false,  &quot;msg&quot;: &quot;notExist&quot;});
                            }
                        }
                    });
                });
            } else {
                callback(null, {&quot;result&quot;: false,  &quot;msg&quot;: &quot;notExist&quot;});
            }
        });
    });
};

//Remove policy_r__ipobj 
policy_r__ipobjModel.deletePolicy_r__All = function (rule, callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sqlExists = &#x27;SELECT * FROM &#x27; + tableModel +
                &#x27; WHERE rule = &#x27; + connection.escape(rule);
        connection.query(sqlExists, function (error, row) {
            //If exists Id from policy_r__ipobj to remove
            if (row) {
                logger.debug(&quot;DELETING IPOBJ FROM RULE: &quot; + rule);
                db.get(function (error, connection) {
                    var sql = &#x27;DELETE FROM &#x27; + tableModel +
                            &#x27; WHERE rule = &#x27; + connection.escape(rule);
                    connection.query(sql, function (error, result) {
                        if (error) {
                            logger.debug(error);
                            callback(error, null);
                        } else {
                            if (result.affectedRows &gt; 0) {
                                callback(null, {&quot;result&quot;: true, &quot;msg&quot;: &quot;deleted&quot;});
                            } else {
                                callback(null, {&quot;result&quot;: false});
                            }
                        }
                    });
                });
            } else {
                callback(null, {&quot;result&quot;: false});
            }
        });
    });
};

//Order policy_r__ipobj Position
policy_r__ipobjModel.orderPolicyPosition = function (rule, position, callback) {

    logger.debug(&quot;DENTRO ORDER   Rule: &quot; + rule + &#x27;  Position: &#x27; + position);

    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sqlPos = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; AND position= &#x27; + connection.escape(position) + &#x27; order by position_order&#x27;;
        logger.debug(sqlPos);
        connection.query(sqlPos, function (error, rows) {
            if (rows.length &gt; 0) {
                var order = 0;
                async.map(rows, function (row, callback1) {
                    order++;
                    db.get(function (error, connection) {
                        sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET position_order=&#x27; + order +
                                &#x27; WHERE rule = &#x27; + connection.escape(row.rule) + &#x27; AND ipobj=&#x27; + connection.escape(row.ipobj) +
                                &#x27; AND ipobj_g=&#x27; + connection.escape(row.ipobj_g) + &#x27; AND position=&#x27; + connection.escape(row.position) +
                                &#x27; AND interface=&#x27; + connection.escape(row.interface);
                        //logger.debug(sql);
                        connection.query(sql, function (error, result) {
                            if (error) {
                                callback1();
                            } else {
                                callback1();
                            }
                        });
                    });
                }, //Fin de bucle
                        function (err) {
                            callback(null, {&quot;result&quot;: true});
                        }

                );

            } else {
                callback(null, {&quot;result&quot;: false});
            }
        });
    });
};

//Order policy_r__ipobj Position
policy_r__ipobjModel.orderPolicy = function (rule, callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sqlRule = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; WHERE rule = &#x27; + connection.escape(rule) + &#x27; order by position, position_order&#x27;;
        logger.debug(sqlRule);
        connection.query(sqlRule, function (error, rows) {
            if (rows.length &gt; 0) {
                var order = 0;
                var prev_position = 0;
                async.map(rows, function (row, callback1) {
                    var position = row.position;
                    if (position !== prev_position) {
                        order = 1;
                        prev_position = position;
                    } else
                        order++;

                    db.get(function (error, connection) {
                        sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET position_order=&#x27; + order +
                                &#x27; WHERE rule = &#x27; + connection.escape(row.rule) + &#x27; AND ipobj=&#x27; + connection.escape(row.ipobj) +
                                &#x27; AND ipobj_g=&#x27; + connection.escape(row.ipobj_g) + &#x27; AND position=&#x27; + connection.escape(row.position) +
                                &#x27; AND interface=&#x27; + connection.escape(row.interface);
                        //logger.debug(sql);
                        connection.query(sql, function (error, result) {
                            if (error) {
                                callback1();
                            } else {
                                callback1();
                            }
                        });
                    });
                }, //Fin de bucle
                        function (err) {
                            callback(null, {&quot;result&quot;: true});
                        }

                );

            } else {
                callback(null, {&quot;result&quot;: false});
            }
        });
    });
};

//Order policy_r__ipobj Position
policy_r__ipobjModel.orderAllPolicy = function (callback) {


    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sqlRule = &#x27;SELECT * FROM &#x27; + tableModel + &#x27; ORDER by rule,position, position_order&#x27;;
        logger.debug(sqlRule);
        connection.query(sqlRule, function (error, rows) {
            if (rows.length &gt; 0) {
                var order = 0;
                var prev_rule = 0;
                var prev_position = 0;
                async.map(rows, function (row, callback1) {
                    var position = row.position;
                    var rule = row.rule;
                    if (position !== prev_position || rule !== prev_rule) {
                        order = 1;
                        prev_rule = rule;
                        prev_position = position;
                    } else
                        order++;

                    db.get(function (error, connection) {
                        sql = &#x27;UPDATE &#x27; + tableModel + &#x27; SET position_order=&#x27; + order +
                                &#x27; WHERE rule = &#x27; + connection.escape(row.rule) + &#x27; AND ipobj=&#x27; + connection.escape(row.ipobj) +
                                &#x27; AND ipobj_g=&#x27; + connection.escape(row.ipobj_g) + &#x27; AND position=&#x27; + connection.escape(row.position) +
                                &#x27; AND interface=&#x27; + connection.escape(row.interface);
                        //logger.debug(sql);
                        connection.query(sql, function (error, result) {
                            if (error) {
                                callback1();
                            } else {
                                callback1();
                            }
                        });
                    });
                }, //Fin de bucle
                        function (err) {
                            logger.debug(&quot;FIN De BUCLE&quot;);
                            callback(null, {&quot;result&quot;: true});
                        }

                );

            } else {
                callback(null, {&quot;result&quot;: false});
            }
        });
    });
};


//FALTA CORREGIR PROBLEMA AL CONTABILIZAR REGISTROS EXISTENTES 

//check if IPOBJ Exists in any rule
policy_r__ipobjModel.checkIpobjInRule = function (ipobj, type, fwcloud, callback) {

    logger.debug(&quot;CHECK DELETING ipobj:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; + &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN  ipobj I on I.id=O.ipobj &#x27; +
                &#x27; WHERE O.ipobj=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT DELETING ipobj IN RULE:&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; + &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                            &#x27; INNER JOIN ipobj__ipobjg G on G.ipobj_g=O.ipobj_g INNER JOIN  ipobj I on I.id=G.ipobj &#x27; +
                            &#x27; WHERE I.ipobj=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);
                    logger.debug(sql);
                    connection.query(sql, function (error, rows) {
                        if (!error) {
                            if (rows.length &gt; 0) {
                                if (rows[0].n &gt; 0) {
                                    logger.debug(&quot;ALERT DELETING ipobj IN GROUP:&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                                    callback(null, {&quot;result&quot;: true});
                                } else {
                                    callback(null, {&quot;result&quot;: false});
                                }
                            } else
                                callback(null, {&quot;result&quot;: false});
                        } else
                            callback(null, {&quot;result&quot;: false});
                    });
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if IPOBJ GROUP  Exists in any rule
policy_r__ipobjModel.checkGroupInRule = function (ipobj_g, fwcloud, callback) {

    logger.debug(&quot;CHECK DELETING  GROUP:&quot; + ipobj_g + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; + &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN  ipobj_g G on G.id=O.ipobj_g &#x27; +
                &#x27; WHERE O.ipobj_g=&#x27; + connection.escape(ipobj_g) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT DELETING ipobj FROM GROUP IN RULE:&quot; + ipobj_g + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        logger.debug(&quot;OK DELETING ipobj FROM GROUP IN RULE:&quot; + ipobj_g + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: false});
                    }
                } else
                    callback(null, {&quot;result&quot;: false});
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if INTERFACE Exists in any rule &#x27;O&#x27; POSITIONS
policy_r__ipobjModel.checkInterfaceInRule = function (interface, type, fwcloud,  callback) {

    logger.debug(&quot;CHECK DELETING interface O POSITIONS:&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; +
                &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; inner join interface I on I.id=O.interface &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(interface) + &#x27; AND I.interface_type=&#x27; + connection.escape(type) + 
                &#x27; AND C.id=&#x27; + connection.escape(fwcloud) ;
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT &lt;INTERFACE&gt; DELETING interface IN RULE:&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if ALL INTERFACE UNDER HOST Exists in any rule
policy_r__ipobjModel.checkHostAllInterfacesInRule = function (ipobj_host, fwcloud, callback) {

    logger.debug(&quot;CHECK DELETING HOST ALL interfaces O POSITIONS:&quot; + ipobj_host + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O &#x27; +
                &#x27; INNER JOIN interface__ipobj J on J.interface=O.interface &#x27; +
                &#x27; INNER JOIN policy_r R on R.id=O.rule &#x27; +
                &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; WHERE J.ipobj=&#x27; + connection.escape(ipobj_host) + &#x27; AND C.id=&#x27; + connection.escape(fwcloud);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT &lt;HOST ALL INTERFACES&gt; DELETING interface IN RULE:&quot; + ipobj_host + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if ALL IPOBJS UNDER ALL INTERFACE UNDER HOST Exists in any rule
policy_r__ipobjModel.checkHostAllInterfaceAllIpobjInRule = function (ipobj_host, fwcloud, callback) {

    logger.debug(&quot;CHECK DELETING HOST ALL IPOBJ UNDER ALL interfaces O POSITIONS:&quot; + ipobj_host + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM interface__ipobj J &#x27; +
                &#x27; inner join ipobj I on I.interface=J.interface &#x27; +
                &#x27; inner join policy_r__ipobj O on O.ipobj=I.id &#x27; +
                &#x27; INNER JOIN policy_r R on R.id=O.rule &#x27; +
                &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; WHERE J.ipobj=&#x27; + connection.escape(ipobj_host) + &#x27; AND C.id=&#x27; + connection.escape(fwcloud);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT &lt;HOST ALL IPOBJ ALL INTERFACES&gt; DELETING interface IN RULE:&quot; + ipobj_host + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if IPOBJ UNDER INTERFACE Exists in any rule
policy_r__ipobjModel.checkOBJInterfaceInRule = function (interface, type, fwcloud, firewall, callback) {

    logger.debug(&quot;CHECK DELETING IPOBJ UNDER interface :&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; + &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; INNER JOIN ipobj I on O.ipobj=I.id INNER JOIN interface Z on Z.id=I.interface&#x27; +
                &#x27; WHERE I.interface=&#x27; + connection.escape(interface) + &#x27; AND Z.interface_type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud) + &#x27; AND F.id=&#x27; + connection.escape(firewall);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT &lt;IPOBJ UNDER INTERFACE&gt; DELETING interface IN RULE:&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};

//check if HOST INTERFACE Exists in any rule
policy_r__ipobjModel.checkHOSTInterfaceInRule = function (interface, type, fwcloud, firewall, callback) {

    logger.debug(&quot;CHECK DELETING HOST interface :&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);
        var sql = &#x27;SELECT count(*) as n FROM &#x27; + tableModel + &#x27; O INNER JOIN policy_r R on R.id=O.rule &#x27; + &#x27; INNER JOIN firewall F on F.id=R.firewall &#x27; +
                &#x27; inner join interface__ipobj J on J.ipobj=O.ipobj  INNER JOIN interface Z on Z.id=J.interface&#x27; +
                &#x27; WHERE J.interface=&#x27; + connection.escape(interface) + &#x27; AND Z.interface_type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud) + &#x27; AND F.id=&#x27; + connection.escape(firewall);
        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    if (rows[0].n &gt; 0) {
                        logger.debug(&quot;ALERT &lt;HOST INTERFACE&gt; DELETING interface IN RULE:&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows[0].n + &quot; RULES&quot;);
                        callback(null, {&quot;result&quot;: true});
                    } else {
                        callback(null, {&quot;result&quot;: false});
                    }
                } else {
                    callback(null, {&quot;result&quot;: false});
                }
            } else
                callback(null, {&quot;result&quot;: false});
        });
    });
};


//------------------- SEARCH METHODS -----------------------------------------------
//FALTA BUSQUEDA de OBJETOS STANDAR SIN FWCLOUD
//check if IPOBJ Exists in any rule
policy_r__ipobjModel.searchIpobjInRule = function (ipobj, type, fwcloud, callback) {

    logger.debug(&quot;SEARCH IN RULES ipobj:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj obj_id,I.name obj_name, I.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name, &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule  &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall  &#x27; +
                &#x27;INNER JOIN  ipobj I on I.id=O.ipobj &#x27; +
                &#x27;inner join ipobj_type T on T.id=I.type &#x27; +
                &#x27;inner join policy_position P on P.id=O.position &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; WHERE O.ipobj=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND ipobj IN RULES:&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//check if INTERFACE Exists in any rule
policy_r__ipobjModel.searchInterfaceInRule = function (interface, type, fwcloud, firewall, callback) {

    logger.debug(&quot;SEARCH IN RULES interface:&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud + &quot;  firewall: &quot; + firewall);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.interface obj_id,I.name obj_name, I.interface_type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name, &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule  &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall  &#x27; +
                &#x27;INNER JOIN  interface I on I.id=O.interface &#x27; +
                &#x27;inner join ipobj_type T on T.id=I.interface_type &#x27; +
                &#x27;inner join policy_position P on P.id=O.position &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; WHERE O.interface=&#x27; + connection.escape(interface) + &#x27; AND I.interface_type=&#x27; + connection.escape(type) + 
                &#x27; AND C.id=&#x27; + connection.escape(fwcloud);
        if (firewall!==null){
            sql = sql + &#x27; AND F.id=&#x27; + connection.escape(firewall);
        }

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND INTERFACE IN RULES:&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//check if IPOBJ Exists in GROUP and GROUP in any rule
policy_r__ipobjModel.searchIpobjGroupInRule = function (ipobj, type, fwcloud, callback) {

    logger.debug(&quot;SEARCH GROUP IN RULES ipobj:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj_g obj_id,GR.name obj_name, GR.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,   &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule  &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall  &#x27; +
                &#x27;INNER JOIN ipobj__ipobjg G ON G.ipobj_g=O.ipobj_g &#x27; +
                &#x27;INNER JOIN ipobj_g GR ON GR.id=G.ipobj_g &#x27; +
                &#x27;INNER JOIN  ipobj I on I.id=G.ipobj &#x27; +
                &#x27;inner join ipobj_type T on T.id=GR.type &#x27; +
                &#x27;inner join policy_position P on P.id=O.position &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND ipobj GROUP IN RULES:&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//check if IPOBJ&#x27;s in GROUP Exists in any rule
policy_r__ipobjModel.searchIpobjInGroupInRule = function (idg,  fwcloud, callback) {

    logger.debug(&quot;SEARCH IPOBJ IN GROUP IN RULES :&quot; + idg + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj obj_id,I.name obj_name, I.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment  &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule   &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall   &#x27; +
                &#x27;INNER JOIN  ipobj I on I.id=O.ipobj &#x27; +
                &#x27;INNER JOIN ipobj__ipobjg G ON G.ipobj=I.id &#x27; +
                &#x27;INNER JOIN ipobj_g GR ON GR.id= G.ipobj_g &#x27; +
                &#x27;inner join ipobj_type T on T.id=I.type  &#x27; +
                &#x27;inner join policy_position P on P.id=O.position  &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type  &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud  &#x27; +
                &#x27; WHERE GR.id=&#x27; + connection.escape(idg) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND ipobjs IN GROUP IN RULES:&quot; + idg +  &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//check if GROUP Exists in any rule
policy_r__ipobjModel.searchGroupInRule = function (idg,  fwcloud, callback) {

    logger.debug(&quot;SEARCH GROUP IN RULES :&quot; + idg +  &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj_g obj_id,GR.name obj_name, GR.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment  &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule   &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall   &#x27; +
                &#x27;INNER JOIN ipobj_g GR ON GR.id=O.ipobj_g  &#x27; +
                &#x27;inner join ipobj_type T on T.id=GR.type  &#x27; +
                &#x27;inner join policy_position P on P.id=O.position  &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type  &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud  &#x27; +
                &#x27; WHERE GR.id=&#x27; + connection.escape(idg) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND GROUP IN RULES:&quot; + idg + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);                    
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};



//Search INTERFACES UNDER IPOBJ HOST that Exists in any rule
policy_r__ipobjModel.searchInterfacesIpobjHostInRule = function (ipobj, type, fwcloud,  callback) {

    logger.debug(&quot;SEARCH INTERFACES UNDER ipobj:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.interface obj_id,K.name obj_name, K.interface_type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN interface K ON K.id = O.interface &#x27; +
                &#x27;INNER JOIN interface__ipobj J ON J.interface = K.id &#x27; +
                &#x27;INNER JOIN ipobj I ON I.id = J.ipobj         &#x27; +
                &#x27;INNER JOIN policy_r R ON R.id = O.rule &#x27; +
                &#x27;INNER JOIN firewall F ON F.id = R.firewall			 &#x27; +
                &#x27;INNER JOIN ipobj_type T ON T.id = K.interface_type &#x27; +
                &#x27;INNER JOIN policy_position P ON P.id = O.position &#x27; +
                &#x27;INNER JOIN policy_type PT ON PT.id = R.type &#x27; +
                &#x27;INNER JOIN fwcloud C ON C.id = F.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(&quot;SQL HOST: &quot; + sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND INTERFACES UNDER ipobj HOST :&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//Search INTERFACES ABOVE IPOBJ  that Exists in any rule
policy_r__ipobjModel.searchInterfacesAboveIpobjInRule = function (ipobj, type, fwcloud,  callback) {

    logger.debug(&quot;SEARCH INTERFACES ABOVE ipobj:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.interface obj_id,K.name obj_name, K.interface_type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN interface K ON K.id = O.interface &#x27; +                
                &#x27;INNER JOIN ipobj I ON I.interface = K.id         &#x27; +
                &#x27;INNER JOIN policy_r R ON R.id = O.rule &#x27; +
                &#x27;INNER JOIN firewall F ON F.id = R.firewall			 &#x27; +
                &#x27;INNER JOIN ipobj_type T ON T.id = K.interface_type &#x27; +
                &#x27;INNER JOIN policy_position P ON P.id = O.position &#x27; +
                &#x27;INNER JOIN policy_type PT ON PT.id = R.type &#x27; +
                &#x27;INNER JOIN fwcloud C ON C.id = F.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(&quot;SQL HOST: &quot; + sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND INTERFACES ABOVE ipobj :&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//SEARCH INTERFACES UNDER IPOBJ HOST WITH HOST IN RULES
policy_r__ipobjModel.searchHostInterfacesHostInRule = function (interface, type, fwcloud, firewall, callback) {

    logger.debug(&quot;SEARCH INTERFACES UNDER HOST ipobj:&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud + &quot;  Firewall: &quot; + firewall);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT I.id obj_id,I.name obj_name, I.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN ipobj I ON I.id = O.ipobj &#x27; +
                &#x27;INNER JOIN interface__ipobj J ON J.ipobj = I.id                 &#x27; +
                &#x27;INNER JOIN interface K ON K.id = J.interface	 &#x27; +
                &#x27;INNER JOIN ipobj_type T ON T.id = I.type         &#x27; +
                &#x27;INNER JOIN policy_r R ON R.id = O.rule &#x27; +
                &#x27;INNER JOIN firewall F ON F.id = R.firewall &#x27; +
                &#x27;INNER JOIN policy_position P ON P.id = O.position &#x27; +
                &#x27;INNER JOIN policy_type PT ON PT.id = R.type &#x27; +
                &#x27;INNER JOIN fwcloud C ON C.id = F.fwcloud &#x27; +
                &#x27; WHERE K.id=&#x27; + connection.escape(interface) + &#x27; AND K.interface_type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);
        if (firewall!==null)
            sql =sql + &#x27; AND F.id=&#x27; + connection.escape(firewall);

        logger.debug(&quot;SQL HOST: &quot; + sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND INTERFACES UNDER ipobj HOST :&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//SEARCH IF IPOBJ UNDER INTERFACES UNDER IPOBJ HOST Has HOST IN RULES &#x27;O&#x27; POSITIONS
policy_r__ipobjModel.searchIpobjInterfacesIpobjHostInRule = function (ipobj, type, fwcloud, callback) {

    logger.debug(&quot;SEARCH IF IPOBJ UNDER INTERFACES UNDER HOST has HOST in RULES:&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj obj_id,IR.name obj_name, IR.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN ipobj IR ON IR.id = O.ipobj &#x27; +
                &#x27;INNER JOIN interface__ipobj J ON J.ipobj = IR.id &#x27; +
                &#x27;INNER JOIN policy_r R ON R.id = O.rule &#x27; +
                &#x27;INNER JOIN interface K ON K.id = J.interface &#x27; +
                &#x27;INNER JOIN ipobj I ON I.interface = K.id &#x27; +
                &#x27;INNER JOIN ipobj_type T ON T.id = IR.type &#x27; +
                &#x27;INNER JOIN policy_position P ON P.id = O.position &#x27; +
                &#x27;INNER JOIN policy_type PT ON PT.id = R.type &#x27; +
                &#x27;INNER JOIN firewall F ON F.id = R.firewall &#x27; +
                &#x27;INNER JOIN fwcloud C ON C.id = F.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND HOST IPOBJ UNDER INTERFACES UNDER ipobj HOST :&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else{
                    logger.debug(&quot;NOT FOUND HOST IPOBJ UNDER INTERFACES UNDER ipobj HOST :&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud );
                    callback(null, {&quot;found&quot;: &quot;&quot;});
                }
            } else{
                logger.debug(error);
                callback(error, null);
            }
        });
    });
};

//SEARCH IF HOST Has IPOBJ UNDER INTERFACES  IN RULES &#x27;O&#x27; POSITIONS
policy_r__ipobjModel.searchIpobjInterfacesIpobjInRule = function (host, type, fwcloud, callback) {

    logger.debug(&quot;XX SEARCH IF HOST Has IPOBJ UNDER INTERFACES  in RULES:&quot; + host + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT O.ipobj obj_id,IR.name obj_name, IR.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name ,O.rule rule_id, R.rule_order,R.type rule_type,PT.name rule_type_name,    &#x27; +
                &#x27;O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O  &#x27; +
                &#x27;INNER JOIN ipobj IR ON IR.id = O.ipobj &#x27; +
                &#x27;INNER JOIN interface K ON K.id = IR.interface         &#x27; +
                &#x27;INNER JOIN interface__ipobj J ON J.interface = K.id &#x27; +
                &#x27;INNER JOIN ipobj I ON I.id = J.ipobj         &#x27; +
                &#x27;INNER JOIN policy_r R ON R.id = O.rule         &#x27; +
                &#x27;INNER JOIN ipobj_type T ON T.id = IR.type         &#x27; +
                &#x27;INNER JOIN policy_position P ON P.id = O.position &#x27; +
                &#x27;INNER JOIN policy_type PT ON PT.id = R.type &#x27; +
                &#x27;INNER JOIN firewall F ON F.id = R.firewall &#x27; +
                &#x27;INNER JOIN fwcloud C ON C.id = F.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(host) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND IPOBJ UNDER INTERFACES UNDER ipobj HOST :&quot; + host + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; RULES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else{
                    logger.debug(&quot;NOT FOUND  IPOBJ UNDER INTERFACES UNDER ipobj HOST :&quot; + host + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud );
                    callback(null, {&quot;found&quot;: &quot;&quot;});
                }
            } else{
                logger.debug(error);
                callback(error, null);
            }
        });
    });
};
//check if Exist IPOBJS under INTERFACES  
policy_r__ipobjModel.searchIpobjInterfaces = function (ipobj, type, fwcloud, callback) {

    logger.debug(&quot;SEARCH IPOBJ UNDER INTERFACES :&quot; + ipobj + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT I.id obj_id,I.name obj_name, I.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, K.id interface_id, K.name interface_name, K.interface_type interface_type_id, TK.type interface_type &#x27; +
                &#x27;FROM ipobj I &#x27; +
                &#x27;INNER JOIN interface K on K.id=I.interface &#x27; +
                &#x27;inner join ipobj_type T on T.id=I.type &#x27; +
                &#x27;inner join ipobj_type TK on TK.id=K.interface_type &#x27; +
                &#x27;left join fwcloud C on C.id=I.fwcloud &#x27; +
                &#x27; WHERE I.id=&#x27; + connection.escape(ipobj) + &#x27; AND I.type=&#x27; + connection.escape(type) + &#x27; AND (I.fwcloud=&#x27; + connection.escape(fwcloud) + &#x27; OR I.fwcloud IS NULL)&#x27;;

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND IPOBJ UNDER INTERFACES  :&quot; + ipobj + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; INTERFACES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};

//check if Exist IPOBJS under INTERFACES  IN RULES 
policy_r__ipobjModel.searchIpobjInterfacesInRules = function (interface, type, fwcloud, firewall, callback) {

    logger.debug(&quot;SEARCH IPOBJ UNDER INTERFACE in RULES:&quot; + interface + &quot; Type:&quot; + type + &quot;  fwcloud:&quot; + fwcloud + &quot;  Firewall: &quot; + firewall);
    db.get(function (error, connection) {
        if (error)
            callback(error, null);

        var sql = &#x27;SELECT I.id obj_id,I.name obj_name, I.type obj_type_id,T.type obj_type_name, &#x27; +
                &#x27;C.id cloud_id, C.name cloud_name, R.firewall firewall_id, F.name firewall_name , &#x27; +
                &#x27;O.rule rule_id, R.rule_order,R.type rule_type,  PT.name rule_type_name,O.position rule_position_id,  P.name rule_position_name,R.comment rule_comment &#x27; +
                &#x27;FROM policy_r__ipobj O &#x27; +
                &#x27;INNER JOIN ipobj I ON I.id=O.ipobj &#x27; +
                &#x27;INNER JOIN interface K on K.id=I.interface  &#x27; +
                &#x27;inner join ipobj_type T on T.id=I.type  &#x27; +
                &#x27;inner join ipobj_type TK on TK.id=K.interface_type  &#x27; +
                &#x27;INNER JOIN policy_r R on R.id=O.rule    &#x27; +
                &#x27;INNER JOIN firewall F on F.id=R.firewall    &#x27; +
                &#x27;inner join fwcloud C on C.id=F.fwcloud  &#x27; +
                &#x27;inner join policy_position P on P.id=O.position  &#x27; +
                &#x27;inner join policy_type PT on PT.id=R.type &#x27; +
                &#x27; WHERE K.id=&#x27; + connection.escape(interface) + &#x27; AND K.interface_type=&#x27; + connection.escape(type) + 
                &#x27; AND F.fwcloud=&#x27; + connection.escape(fwcloud);
        if (firewall!==null)
            sql=sql + &#x27; AND F.id=&#x27; + connection.escape(firewall);

        logger.debug(sql);
        connection.query(sql, function (error, rows) {
            if (!error) {
                if (rows.length &gt; 0) {
                    logger.debug(&quot;FOUND IPOBJ UNDER INTERFACES  :&quot; + interface + &quot; type: &quot; + type + &quot; fwcloud:&quot; + fwcloud + &quot; --&gt; FOUND IN &quot; + rows.length + &quot; INTERFACES&quot;);
                    //logger.debug(rows);
                    callback(null, {&quot;found&quot;: rows});

                } else
                    callback(null, {&quot;found&quot;: &quot;&quot;});
            } else
                callback(error, null);
        });
    });
};


//Export the object
module.exports = policy_r__ipobjModel;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
