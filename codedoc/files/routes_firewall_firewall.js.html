<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>routes/firewall/firewall.js - FWCloud API REST Documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://foswiki.soltecsis.com/codedoc/soltecsis-logo1.png" title="FWCloud API REST Documentation"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ClusterRouter.html">ClusterRouter</a></li>
                                <li><a href="../classes/CompileRouter.html">CompileRouter</a></li>
                                <li><a href="../classes/FirewallModel.html">FirewallModel</a></li>
                                <li><a href="../classes/FirewallRouter.html">FirewallRouter</a></li>
                                <li><a href="../classes/FwcloudModel.html">FwcloudModel</a></li>
                                <li><a href="../classes/FwcloudRouter.html">FwcloudRouter</a></li>
                                <li><a href="../classes/IpobjModel.html">IpobjModel</a></li>
                                <li><a href="../classes/IpobjsRouter.html">IpobjsRouter</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Cluster.html">Cluster</a></li>
                                <li><a href="../modules/Compile.html">Compile</a></li>
                                <li><a href="../modules/Firewall.html">Firewall</a></li>
                                <li><a href="../modules/FirewallExport.html">FirewallExport</a></li>
                                <li><a href="../modules/Fwcloud.html">Fwcloud</a></li>
                                <li><a href="../modules/Ipobjs.html">Ipobjs</a></li>
                                <li><a href="../modules/OpenVPN.html">OpenVPN</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: routes/firewall/firewall.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Module to routing Firewalls requests
 * &lt;br&gt;BASE ROUTE CALL: &lt;b&gt;/firewalls&lt;/b&gt;
 *
 * @module Firewall
 * 
 * 
 */

/**
 * Class to manage firewalls routing
 * 
 * 
 * @class FirewallRouter
 * 
 */

/**
 * Property  to manage express
 *
 * @property express
 * @type express
 */
var express = require(&#x27;express&#x27;);

/**
 * Property  to manage Firewall route
 *
 * @property router
 * @type express.Router 
 */
var router = express.Router();

/**
 * Property Model to manage API RESPONSE data: {{#crossLinkModule &quot;api_response&quot;}}{{/crossLinkModule}}
 *
 * @property api_resp
 * @type api_respModel
 * 
 */
var api_resp = require(&#x27;../../utils/api_response&#x27;);

/**
 * Property to identify Data Object
 *
 * @property objModel
 * @type text
 */
var objModel = &#x27;FIREWALL&#x27;;

/**
 * Property Model to manage Firewall Data
 *
 * @property FirewallModel
 * @type ../../models/firewall/firewall
 * 
 * 
 */
var FirewallModel = require(&#x27;../../models/firewall/firewall&#x27;);
var FirewallExport = require(&#x27;../../models/firewall/export&#x27;);

/**
 * Property Model to manage Fwcloud Data
 *
 * @property FwcloudModel
 * @type ../../models/fwcloud
 * 
 * 
 */
var FwcloudModel = require(&#x27;../../models/fwcloud/fwcloud&#x27;);

/**
 * Property Logger to manage App logs
 *
 * @attribute logger
 * @type log4js/app
 * 
 */
var logger = require(&#x27;log4js&#x27;).getLogger(&quot;app&quot;);


var utilsModel = require(&quot;../../utils/utils.js&quot;);

var fwcTreemodel = require(&#x27;../../models/tree/tree&#x27;);

var InterfaceModel = require(&#x27;../../models/interface/interface&#x27;);

var Policy_rModel = require(&#x27;../../models/policy/policy_r&#x27;);
var Policy_cModel = require(&#x27;../../models/policy/policy_c&#x27;);

const restrictedCheck = require(&#x27;../../middleware/restricted&#x27;);
const config = require(&#x27;../../config/config&#x27;);


/**
 * Get Firewalls by User
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/:iduser__      
 * &gt; METHOD:  __GET__
 * 
 * @method getFirewallByUser
 * 
 * @param {Integer} iduser User identifier
 * 
 * @return {JSON} Returns &#x60;JSON&#x60; Data from Firewall
 * @example #### JSON RESPONSE
 *    
 *       {&quot;data&quot; : [
 *          {  //Data Firewall 1       
 *           &quot;id&quot; : ,            //Firewall Identifier
 *           &quot;cluster&quot; : ,       //Cluster
 *           &quot;fwcloud&quot; : ,       //Id Firewall cloud
 *           &quot;name&quot; : ,          //Firewall name
 *           &quot;comment&quot; : ,       //comment
 *           &quot;created_at&quot; : ,    //Date Created
 *           &quot;updated_at&quot; : ,    //Date Updated
 *           &quot;by_user&quot; : ,       //User last update
 *          },
 *          {....}, //Data Firewall 2
 *          {....}  //Data Firewall ...n 
 *         ]
 *       };
 * 
 */
router.put(&#x27;/all/get&#x27;, (req, res) =&gt; {
	FirewallModel.getFirewalls(req.session.user_id, function(error, data) {
		//Get data
		if (data &amp;&amp; data.length &gt; 0) {
			api_resp.getJson(data, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
		//Get error
		else {
			api_resp.getJson(data, api_resp.ACR_NOTEXIST, &#x27;not found&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
	});
});

/**
 * Get Firewalls by Cloud
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/Cloud/__      
 * &gt; METHOD:  __GET__
 * 
 * @method getFirewallByUser_and_Cloud
 * 
 * @param {Integer} iduser User identifier
 * @param {Number} fwcloud Cloud identifier
 * 
 * @return {JSON} Returns &#x60;JSON&#x60; Data from Firewall
 * @example #### JSON RESPONSE
 *    
 *       {&quot;data&quot; : [
 *          {  //Data Firewall 1       
 *           &quot;id&quot; : ,            //Firewall Identifier
 *           &quot;cluster&quot; : ,       //Cluster
 *           &quot;fwcloud&quot; : ,       //Id Firewall cloud
 *           &quot;name&quot; : ,          //Firewall name
 *           &quot;comment&quot; : ,       //comment
 *           &quot;created_at&quot; : ,    //Date Created
 *           &quot;updated_at&quot; : ,    //Date Updated
 *           &quot;by_user&quot; : ,       //User last update
 *          },
 *          {....}, //Data Firewall 2
 *          {....}  //Data Firewall ...n 
 *         ]
 *       };
 * 
 */
router.put(&#x27;/cloud/get&#x27;, (req, res) =&gt; {
	FirewallModel.getFirewallCloud(req.session.user_id, req.body.fwcloud, (error, data) =&gt; {
		//get data
		if (data &amp;&amp; data.length &gt; 0) {
			api_resp.getJson(data, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
		//Get Error
		else {
			api_resp.getJson(data, api_resp.ACR_NOTEXIST, &#x27;not found&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
	});
});


/**
 * Get Firewalls by User and ID
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/:iduser/:id__      
 * &gt; METHOD:  __GET__
 * 
 * @method getFirewallByUser_and_Id
 * 
 * @param {Integer} iduser User identifier
 * @param {Integer} id firewall identifier
 * 
 * @return {JSON} Returns &#x60;JSON&#x60; Data from Firewall
 * @example #### JSON RESPONSE
 *    
 *       {&quot;data&quot; : [
 *          {  //Data Firewall        
 *           &quot;id&quot; : ,            //Firewall Identifier
 *           &quot;cluster&quot; : ,       //Cluster
 *           &quot;fwcloud&quot; : ,       //Id Firewall cloud
 *           &quot;name&quot; : ,          //Firewall name
 *           &quot;comment&quot; : ,       //comment
 *           &quot;created_at&quot; : ,    //Date Created
 *           &quot;updated_at&quot; : ,    //Date Updated
 *           &quot;compiled_at&quot; : ,   //Date Compiled
 *           &quot;installed_at&quot; : ,  //Date Installed
 *           &quot;by_user&quot; : ,       //User last update
 *          }
 *         ]
 *       };
 * 
 */
router.put(&#x27;/get&#x27;, async (req, res) =&gt; {
	try {
		const data = await FirewallModel.getFirewall(req);
		if (data &amp;&amp; data.length &gt; 0)
			api_resp.getJson(data, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
		else
			api_resp.getJson(data, api_resp.ACR_NOTEXIST, &#x27;not found&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
	} catch(error) { api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)) }
});



/**
 * Get Firewalls by Cluster
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/:iduser/cluster/:idcluster__      
 * &gt; METHOD:  __GET__
 * 
 * @method getFirewallByUser_and_Cluster
 * 
 * @param {Integer} iduser User identifier
 * @param {Number} idcluster Cluster identifier
 * 
 * @return {JSON} Returns &#x60;JSON&#x60; Data from Firewall
 * @example #### JSON RESPONSE
 *    
 *       {&quot;data&quot; : [
 *          {  //Data Firewall 1       
 *           &quot;id&quot; : ,            //Firewall Identifier
 *           &quot;cluster&quot; : ,       //Cluster
 *           &quot;fwcloud&quot; : ,       //Id Firewall cloud
 *           &quot;name&quot; : ,          //Firewall name
 *           &quot;comment&quot; : ,       //comment
 *           &quot;created_at&quot; : ,    //Date Created
 *           &quot;updated_at&quot; : ,    //Date Updated
 *           &quot;by_user&quot; : ,       //User last update
 *          },
 *          {....}, //Data Firewall 2
 *          {....}  //Data Firewall ...n 
 *         ]
 *       };
 * 
 */
router.put(&#x27;/cluster/get&#x27;, (req, res) =&gt; {
	FirewallModel.getFirewallCluster(req.session.user_id, req.body.cluster, function(error, data) {
		//get data
		if (data &amp;&amp; data.length &gt; 0) {
			api_resp.getJson(data, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
		//Get Error
		else {
			api_resp.getJson(data, api_resp.ACR_NOTEXIST, &#x27;not found&#x27;, objModel, null, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		}
	});
});


/**
 * CREATE New firewall
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/firewall__      
 * &gt; METHOD:  __POST__
 * 
 *
 * @method AddFirewall
 * 
 * @param {Integer} id Firewall identifier (AUTO)
 * @param {Integer} iduser User identifier
 * @param {Integer} cluster Cluster identifier
 * @param {String} name Firewall Name
 * @param {String} [comment] Firewall comment
 * 
 * @return {JSON} Returns Json result
 * @example 
 * #### JSON RESPONSE OK:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;insertId : ID,   //firewall identifier           
 *          }
 *         ]
 *       };
 *       
 * #### JSON RESPONSE ERROR:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;msg : ERROR,   //Text Error
 *          }
 *         ]
 *       };
 */
router.post(&#x27;/&#x27;, async(req, res) =&gt; {
	var firewallData = {
		id: null,
		cluster: req.body.cluster,
		name: req.body.name,
		status: 3,
		comment: req.body.comment,
		fwcloud: req.body.fwcloud,
		install_user: req.body.install_user,
		install_pass: req.body.install_pass,
		save_user_pass: req.body.save_user_pass,
		install_interface: req.body.install_interface,
		install_ipobj: req.body.install_ipobj,
		fwmaster: req.body.fwmaster,
		install_port: req.body.install_port,
		by_user: req.session.user_id,
		options: req.body.options
	};

	try {
		// Check that the tree node in which we will create a new node for the firewall is a valid node for it.
		if (req.tree_node.node_type!==&#x27;FDF&#x27; &amp;&amp; req.tree_node.node_type!==&#x27;FD&#x27;) throw(new Error(&#x27;Bad node tree type&#x27;));

		firewallData = await FirewallModel.checkBodyFirewall(firewallData, true);

		//encript username and password
		firewallData.install_user = (firewallData.install_user) ? await utilsModel.encrypt(firewallData.install_user) : &#x27;&#x27;;
		firewallData.install_pass = (firewallData.install_pass) ? await utilsModel.encrypt(firewallData.install_pass) : &#x27;&#x27;;

		let data = await FirewallModel.insertFirewall(req.session.user_id, firewallData);
		if (data &amp;&amp; data.insertId) {
			var dataresp = { &quot;insertId&quot;: data.insertId };
			var newFirewallId = data.insertId;

			await FirewallModel.updateFWMaster(req.session.user_id, req.body.fwcloud, firewallData.cluster, newFirewallId, firewallData.fwmaster);

			if ((firewallData.cluster &gt; 0 &amp;&amp; firewallData.fwmaster === 1) || firewallData.cluster === null) {
				// Create the loop backup interface.
				const loInterfaceId = await InterfaceModel.createLoInterface(req.body.fwcloud, newFirewallId);
				await Policy_rModel.insertDefaultPolicy(newFirewallId, loInterfaceId);
			}

			if (!firewallData.cluster) // Create firewall tree.
				await fwcTreemodel.insertFwc_Tree_New_firewall(req.body.fwcloud, req.body.node_id, newFirewallId);
			else // Create the new firewall node in the NODES node of the cluster.
				await fwcTreemodel.insertFwc_Tree_New_cluster_firewall(req.body.fwcloud, firewallData.cluster, newFirewallId, firewallData.name);

			// Create the directory used for store firewall data.
			await utilsModel.createFirewallDataDir(req.body.fwcloud, newFirewallId);

			api_resp.getJson(dataresp, api_resp.ACR_INSERTED_OK, &#x27;INSERTED OK&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
		} else api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, &quot;&quot;, jsonResp =&gt; res.status(200).json(jsonResp));
	} catch (error) { api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Creating firewall&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)) }
});


/**
 * UPDATE firewall
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/firewall__      
 * &gt; METHOD:  __PUT__
 * 
 *
 * @method UpdateFirewall
 * 
 * @param {Integer} id Firewall identifier
 * @optional
 * @param {Integer} iduser User identifier
 * @param {Integer} cluster Cluster identifier
 * @param {String} name Firewall Name
 * @param {String} comment Firewall comment
 * 
 * @return {JSON} Returns Json result
 * @example 
 * #### JSON RESPONSE OK:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;msg : &quot;success&quot;,   //result
 *          }
 *         ]
 *       };
 *       
 * #### JSON RESPONSE ERROR:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;msg : ERROR,   //Text Error
 *          }
 *         ]
 *       };
 */
router.put(&#x27;/&#x27;, (req, res) =&gt; {
	//Save firewall data into objet    
	var firewallData = {
		id: req.body.firewall,
		cluster: req.body.cluster,
		name: req.body.name,
		comment: req.body.comment,
		fwcloud: req.body.fwcloud, //working cloud      
		install_user: req.body.install_user,
		install_pass: req.body.install_pass,
		save_user_pass: req.body.save_user_pass,
		install_interface: req.body.install_interface,
		install_ipobj: req.body.install_ipobj,
		fwmaster: req.body.fwmaster,
		install_port: req.body.install_port,
		by_user: req.session.user_id, //working user
		options: req.body.options
	};

	//logger.debug(firewallData);
	Policy_cModel.deleteFullFirewallPolicy_c(req.body.firewall)
		.then(() =&gt; FirewallModel.updateFirewallStatus(req.body.fwcloud, req.body.firewall, &quot;|3&quot;))
		.then(() =&gt; FirewallModel.checkBodyFirewall(firewallData, false))
		.then(result =&gt; {
			firewallData = result;
			//encript username and password
			utilsModel.encrypt(firewallData.install_user)
				.then(data =&gt; {
					logger.debug(&quot;SSHUSER: &quot; + firewallData.install_user + &quot;   ENCRYPTED: &quot; + data);
					firewallData.install_user = data;
				})
				.then(utilsModel.encrypt(firewallData.install_pass)
					.then(data =&gt; {
						logger.debug(&quot;SSPASS: &quot; + firewallData.install_pass + &quot;   ENCRYPTED: &quot; + data);
						firewallData.install_pass = data;
					}))
				.then(() =&gt; {
					logger.debug(&quot;SAVING DATA NODE CLUSTER. SAVE USER_PASS:&quot;, firewallData.save_user_pass);
					if (!firewallData.save_user_pass) {
						firewallData.install_user = &#x27;&#x27;;
						firewallData.install_pass = &#x27;&#x27;;
					}

					FirewallModel.updateFirewall(req.session.user_id, firewallData, function(error, data) {
						//Saved ok
						if (data &amp;&amp; data.result) {
							FirewallModel.updateFWMaster(req.session.user_id, req.body.fwcloud, firewallData.cluster, req.body.firewall, firewallData.fwmaster)
								.then(() =&gt; {
									//////////////////////////////////
									//UPDATE FIREWALL NODE STRUCTURE                                    
									fwcTreemodel.updateFwc_Tree_Firewall(req.session.user_id, req.body.fwcloud, firewallData, function(error, data) {
										if (error)
											api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, function(jsonResp) {
												res.status(200).json(jsonResp);
											});
										else if (data &amp;&amp; data.result)
											api_resp.getJson(data, api_resp.ACR_UPDATED_OK, &#x27;UPDATED OK&#x27;, objModel, null, function(jsonResp) {
												res.status(200).json(jsonResp);
											});
										else
											api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, function(jsonResp) {
												res.status(200).json(jsonResp);
											});
									});
								})
								.catch(error =&gt; api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)));
						} else {
							api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, function(jsonResp) {
								res.status(200).json(jsonResp);
							});
						}
					});

				})
				.catch(e =&gt; {
					logger.debug(e);
					api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, e, function(jsonResp) {
						res.status(200).json(jsonResp);
					});
				});

		})
		.catch(e =&gt; {
			logger.error(&quot;ERROR UPDATING FIREWALL: &quot;, e);
			api_resp.getJson(null, api_resp.ACR_ERROR, e, objModel, e, function(jsonResp) {
				res.status(200).json(jsonResp);
			});
		});
});


router.put(&#x27;/clone&#x27;, async (req, res) =&gt; {
	// Check that the tree node in which we will create a new node for the firewall is a valid node for it.
	if (req.tree_node.node_type!==&#x27;FDF&#x27; &amp;&amp; req.tree_node.node_type!==&#x27;FD&#x27;)
		return api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Bad node tree type&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));

	//Save firewall data into objet    
	var firewallData = {
		id: req.body.firewall,
		name: req.body.name,
		comment: req.body.comment,
		fwcloud: req.body.fwcloud, //working cloud      
		by_user: req.session.user_id //working user
	};

	try {
		const data = await FirewallModel.cloneFirewall(req.session.user_id, firewallData);
		if (data &amp;&amp; data.result) {
			const idNewFirewall = data.insertId;

			const dataI = await InterfaceModel.cloneFirewallInterfaces(req.session.user_id, req.body.fwcloud, req.body.firewall, idNewFirewall);
			await Policy_rModel.cloneFirewallPolicy(req.session.user_idr, req.body.fwcloud, req.body.firewall, idNewFirewall, dataI);
			await utilsModel.createFirewallDataDir(req.body.fwcloud, idNewFirewall);
			await fwcTreemodel.insertFwc_Tree_New_firewall(req.body.fwcloud, req.body.node_id, idNewFirewall);
			api_resp.getJson(data, api_resp.ACR_UPDATED_OK, &#x27;CLONED OK&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
		} else api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
	} catch(error) { api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, e, jsonResp =&gt; res.status(200).json(jsonResp)) }
});



/* Get locked Status of firewall by Id */
/**
 * Get Locked status of Firewall by ID and User
 * 
 * &lt;br&gt;ROUTE CALL:  &lt;b&gt;/firewalls/:iduser/firewall/:id/locked&lt;/b&gt;
 * &lt;br&gt;METHOD: &lt;b&gt;GET&lt;/b&gt;
 *
 * @method getLockedStatusFirewallByUser_and_ID_V2
 * 
 * @param {Integer} iduser User identifier
 * @param {Integer} id Firewall identifier
 * 
 * @return {JSON} Returns Json Data from Firewall
 */
router.put(&#x27;/accesslock/get&#x27;, async (req, res) =&gt; {
	try {
		const data = await FirewallModel.getFirewall(req);
		if (data &amp;&amp; data.length &gt; 0) {
			await FwcloudModel.getFwcloudAccess(req.session.user_id, req.body.fwcloud);
			api_resp.getJson(resp, api_resp.ACR_OK, &#x27;&#x27;, &quot;&quot;, null, jsonResp =&gt; res.status(200).json(jsonResp));
		}
	} catch(error) { api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)) }
});


// API call for check deleting restrictions.
router.put(&quot;/restricted&quot;,
	restrictedCheck.firewall,
	restrictedCheck.firewallApplyTo,
	(req, res) =&gt; api_resp.getJson(null, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp)));


/**
 * DELETE firewall
 * 
 * 
 * &gt; ROUTE CALL:  __/firewalls/firewall__      
 * &gt; METHOD:  __DELETE__
 * 
 *
 * @method DeleteFirewall
 * 
 * @param {Integer} id Firewall identifier
 * @optional
 * 
 * @return {JSON} Returns Json result
 * @example 
 * #### JSON RESPONSE OK:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;msg : &quot;success&quot;,   //result
 *          }
 *         ]
 *       };
 *       
 * #### JSON RESPONSE ERROR:
 *    
 *       {&quot;data&quot; : [
 *          { 
 *           &quot;msg : ERROR,   //Text Error
 *          }
 *         ]
 *       };
 */
router.put(&#x27;/del&#x27;,
	restrictedCheck.firewall,
	async(req, res) =&gt; {
		try {
			data = await FirewallModel.deleteFirewall(req.session.user_id, req.body.fwcloud, req.body.firewall);
			if (data &amp;&amp; data.result)
				api_resp.getJson(data, api_resp.ACR_DELETED_OK, &#x27;&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
			else
				api_resp.getJson(data, api_resp.ACR_RESTRICTED, &#x27;Error&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
		} catch (error) { api_resp.getJson(null, api_resp.ACR_ACCESS_ERROR, &#x27;Error&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)) }
	});

//DELETE FIREWALL FROM CLUSTER
router.put(&#x27;/delfromcluster&#x27;,
restrictedCheck.firewall,
restrictedCheck.firewallApplyTo,
(req, res) =&gt; {
	//CHECK FIREWALL DATA TO DELETE
	FirewallModel.deleteFirewallFromCluster(req.session.user_id, req.body.fwcloud, req.body.firewall, req.body.cluster)
	.then(data =&gt; {
		if (data &amp;&amp; data.result)
			api_resp.getJson(data, api_resp.ACR_DELETED_OK, &#x27;&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
	 	else
			api_resp.getJson(data, api_resp.ACR_ERROR, &#x27;Error&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
	})
	.catch(error =&gt; api_resp.getJson(null, api_resp.ACR_ACCESS_ERROR, &#x27;Error&#x27;, objModel, error, jsonResp =&gt; res.status(200).json(jsonResp)));
});

/**
 * Get firewall export
 * 
 */
router.put(&#x27;/export/get&#x27;, (req, res) =&gt; {
	FirewallExport.exportFirewall(req.body.firewall)
		.then(data =&gt; {
			api_resp.getJson(data, api_resp.ACR_OK, &#x27;&#x27;, objModel, null, jsonResp =&gt; res.status(200).json(jsonResp));
		})
		.catch(err =&gt; api_resp.getJson(null, api_resp.ACR_ERROR, &#x27;&#x27;, objModel, err, jsonResp =&gt; res.status(200).json(jsonResp)));
});

module.exports = router;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
