#!/bin/sh 
#############################################
##                                         ##
##  FWCloud.net                            ##
##  Developed by SOLTECSIS, S.L.           ##
##  http://www.soltecsis.com               ##
##  info@soltecsis.com                     ##
##                                         ##
#############################################

LSMOD=`which lsmod`
MODPROBE=`which modprobe`
#IPTABLES=`which iptables`
IPTABLES="echo"
IP6TABLES=`which ip6tables`
IP=`which ip`

log() {
  echo "$1"
  which "$LOGGER" >/dev/null 2>&1 && $LOGGER -p info "$1"
}

find_cmd() {
  PGM=$1
  which $PGM >/dev/null 2>&1 || {
    echo "\"$PGM\" not found"
    exit 1
  }
}

check_cmds() {
  find_cmd which
  find_cmd $IPTABLES
  find_cmd $MODPROBE
  find_cmd $IP
}

stop() {
  reset_all
  $IPTABLES -P OUTPUT  ACCEPT
  $IPTABLES -P INPUT   ACCEPT
  $IPTABLES -P FORWARD ACCEPT
}

load_modules() {
  MODULES_DIR="/lib/modules/`uname -r`/kernel/net/"
  MODULES=$(find $MODULES_DIR -name '*conntrack*' -name '*nat*'|sed  -e 's/^.*\///' -e 's/\([^\.]\)\..*/\1/')
  for module in $MODULES; do
    if $LSMOD | grep ${module} >/dev/null; then continue; fi
    $MODPROBE ${module} ||  exit 1
  done
}

policy_load() {
